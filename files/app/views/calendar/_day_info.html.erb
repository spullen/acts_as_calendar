<% size = @events.size %>
<% count = 1 %>
<% more = size - 4 %>
<% @more_events = [] %>
<% for event in @events %>
  <% if count < 5 %>
    <div class="event">
      <span class="time" title="ends at <%= event.read_attribute(event.class.calendar_end_dt_field).to_s(:time) %>">
        <%=h event.read_attribute(event.class.calendar_start_dt_field).to_s(:time) %>
      </span>
      <span class="label"><%=h event.read_attribute(event.class.calendar_event_title_field) %></span>
    </div>    
  <% elsif count == 5 %>
    <% if more < 2 %>
      <div class="event">
        <span class="time"><%=h event.read_attribute(event.class.calendar_start_dt_field).to_s(:time) %></span>
        <span class="label"><%=h event.read_attribute(event.class.calendar_event_title_field) %></span>
      </div>
    <% else %>
      <div class="more">
        <%= link_to "+#{more} more", '#', :onclick => "showmore" %>
      </div>
    <% @more_events << event %>
    <% end %>
  <% elsif count > 5 %>
    <% @more_events << event %>
  <% end %>
  <% count += 1 %>
<% end %>

<% unless @more_events.blank? %>
<div id="more" class="more_events">
  <% for mevent in @more_events %>
  <div class="event">
    <span class="time" title="ends at <%= "#{mevent.read_attribute(event.class.calendar_end_dt_field).to_s(:time)}" %>">
      <%=h mevent.read_attribute(event.class.calendar_start_dt_field).to_s(:time) %>
    </span>
    <span class="label"><%=h mevent.read_attribute(event.class.calendar_event_title_field) %></span>
  </div>
  <% end %>
</div>
<% end %>